pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--game

function _init()
  b = board:new(10,10)
  hx=1
  hy=1
end

function _update()
  local dx,dy = getdirinput()
  hx=mid(1,hx+dx,b.width)
  hy=mid(1,hy+dy,b.height)

  if btnp(❎) then
    b:add(hx,hy,1)
  end
end

function _draw()
  cls()
  b:draw(64,64)
  b:highlight(hx,hy)
end

-->8
--board

board={
  __tostring=function(self) return "<board:"..self.width..":"..self.height..">" end
}

function board:new(w,h)
  local b={}
  setmetatable(b, board)
  --constructor
  b.width = w
  b.height = h
  b.centerx = 64
  b.centery = 64
  b.tiles = {}
  b.twidth = 8
  b.theight = 8

  b.bgtile = 5
  b.bgsel = 6

  --methods
  b.get = board_get
  b.add = board_add
  b.remove = board_remove
  b.clear = board_clear
  b.draw = board_draw
  b.hash = board_hash
  b.unhash = board_unhash
  b.highlight = board_highlight

  --end class
  return b
end

function board_hash(self,x,y) 
  return (self.width*(y-1))+x-1
end

function board_unhash(self,val) 
  local dx,dy = val%(self.width), val\(self.width)
  return dx+1, dy+1
end

function board_get(self,x,y)
  return self.tiles[self:hash(x,y)]
end

function board_add(self,x,y,v)
  self.tiles[self:hash(x,y)] = v
end

function board_remove(self,x,y)
  deli(self.tiles, self:hash(x,y))
end

function board_clear(self)
  self.tiles = {}
end

function board_getsize(self)
  local w,h = self.width*self.twidth, self.height*self.theight
  local x,y = self.centerx-w/2, self.centery-h/2
  return x,y,w,h
end

function board_draw(self)
  local x,y,w,h = board_getsize(self)
  --draw bg tiles
  for j=1,self.height do
    x=self.centerx-w/2
    for i=1,self.width do
      spr(self.bgtile,
      x,
      y,
      self.twidth/8,
      self.theight/8)
      x+=self.twidth
    end
    y+=self.theight
  end
  x,y = self.centerx-w/2, self.centery-h/2
  --draw tiles
  for k,v in pairs(self.tiles) do
    local dx,dy = self:unhash(k)
    spr(v,
    x+(dx-1)*self.twidth,
    y+(dy-1)*self.theight,
    self.twidth/8,
    self.theight/8)
  end
end

function board_highlight(self,tx,ty)
  local x,y,w,h = board_getsize(self)
  spr(21,
    x+(tx-1)*self.twidth,
    y+(ty-1)*self.theight,
    self.twidth/8,
    self.theight/8)
end

-->8
--input
function getdirinput()
  local bu = btnp(⬆️) and 1 or 0
  local bd = btnp(⬇️) and 1 or 0
  local bl = btnp(⬅️) and 1 or 0
  local br = btnp(➡️) and 1 or 0
  return br-bl,bd-bu
end

__gfx__
00000000066666600666666006666660066666601111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d663b666d668e666d661c666d669a6661000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700d663b666d668e666d661c666d669a6661000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000d6333b66d6888e66d6111c66d6999a661000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000d6333b66d6888e66d6111c66d6999a661000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700d33333b6d88888e6d11111c6d99999a61000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d33333b6d88888e6d11111c6d99999a61000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dddddd00dddddd00dddddd00dddddd01111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666600666666006666660066666608880088800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d66bb666d66ee666d66cc666d66aa6668000000800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6333b66d6888e66d6111c66d6999a668000000800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d33333b6d88888e6d11111c6d99999a60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d33333b6d88888e6d11111c6d99999a60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6333366d6888866d6111166d69999668000000800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6633666d6688666d6611666d66996668000000800000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dddddd00dddddd00dddddd00dddddd08880088800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666600666666006666660066666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6666666d6666666d6666666d66666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d633bb66d688ee66d611cc66d699aa660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6333b66d6888e66d6111c66d6999a660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6333366d6888866d6111166d69999660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6333366d6888866d6111166d69999660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d6666666d6666666d6666666d66666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dddddd00dddddd00dddddd00dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
