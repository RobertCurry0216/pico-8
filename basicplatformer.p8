pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--variables

function _init()
	player={
		sp=1,
		x=64,
		y=64,
		w=8,
		h=8,
		flp=false,
		
		dx=0,
		dy=0,
		max_dx=2,
		max_dy=3,
		acc=0.5,
		boost=4,
		
		anim=0,
		running=false,
		jumping=false,
		falling=false,
		sliding=false,
		landed=false
	}
	
	grav=0.3
	fric=0.85
end

-->8
--draw

function _draw()
	cls()
	map(0,0)
	spr(
		player.sp,
		player.x,
		player.y,
		1,
		1,
		player.flp
	)
end
-->8
--update

function _update()
	player_update()
	player_anim()
end
-->8
--collisions

function collide_map(obj,dir,flag)
	local x,y=obj.x,obj.y
	local w,h=obj.w,obj.h
	local x1,y1,x2,y2=0,0,0,0
	
	if dir=="up" then
		x1=x+2  		y1=y-1
		x2=x+w-3  y2=y
	elseif dir=="down" then
		x1=x+2		  y1=y+h
		x2=x+w-3  y2=y+h+1
	elseif dir=="left" then
		x1=x-1		  y1=y
		x2=x      y2=y+h-1
	elseif dir=="right" then
 	x1=x+w		  y1=y
		x2=x+w+1  y2=y+h-1
	end
	x1/=8 y1/=8
	x2/=8 y2/=8
	if fget(mget(x1,y1),flag)
	or fget(mget(x1,y2),flag)
	or fget(mget(x2,y1),flag)
	or fget(mget(x2,y2),flag)
	then
		return true
	end
	return false
end
-->8
--player

function player_update()
	--physics
	player.dy+=grav
	player.dx*=fric
	
	--controls
	if btn(⬅️) then
		player.dx-=player.acc
		player.running=true
		player.flp=true
	end
	if btn(➡️) then
		player.dx+=player.acc
		player.running=true
		player.flp=false
	end
	
	--slide
	if player.running
	and not btn(⬅️)
	and not btn(➡️)
	and not player.falling
	and not player.jumping
	then
		player.running=false
		player.sliding=true
	end
	
	--jmp
	if btnp(❎)
	and player.landed
	then
		player.dy-=player.boost
		player.landed=false
	end
	
	--check collision
	if player.dy>0 then
		player.falling=true
		player.landed=false
		player.jumping=false
		
		if collide_map(player,"down",0) then
			player.landed=true
			player.falling=false
			player.dy=0
			player.y-=((player.y+player.h+1)%8)-1
		end
	elseif player.dy<0 then
		player.jumping=true
		if collide_map(player,"up",1) then
			player.dy=0
		end
	end
		
		
	if player.dx<0 then
		if collide_map(player,"left",1) then
			player.dx=0
		end
	elseif player.dx>0 then
		if collide_map(player,"right",1) then
			player.dx=0
		end
	end
	
	--stop sliding
	if player.sliding then
		if abs(player.dx)<0.2 then
			player.dx=0
			player.sliding=false
		end
	end
	
	--limit speed
	player.dx=mid(
		-player.max_dx,
		player.dx,
		player.max_dx
	)
	player.dy=mid(
		-player.max_dy,
		player.dy,
		player.max_dy
	)
	
	--move player
	player.x+=player.dx
	player.y+=player.dy
end

function player_anim()
	if player.jumping then
		player.sp=7
	elseif player.falling then
		player.sp=8
	elseif player.sliding then
		player.sp=9
	elseif player.running then
		if time()-player.anim>0.1 then
			player.anim=time()
			player.sp+=1
			if player.sp>6 then
				player.sp=3
			end
		end
	else
	 if time()-player.anim>0.4 then
			player.anim=time()
			player.sp+=1
			if player.sp>2 then
				player.sp=1
			end
		end
	end
end
__gfx__
0000000000444440004444400004444400044444000444440004444400044444c004444400000000000000000000000000000000000000000000000000000000
0000000000ccccc000ccccc00ccccccc0c0cccccc0ccccccc00ccccc00cccccc0ccccccc04444400000000000000000000000000000000000000000000000000
007007000cf72f200cf72f20c00ff72fc0cff72f0c0ff72f0ccff72f0c0ff72f000ff72f0ccccc00000000000000000000000000000000000000000000000000
000770000cfffff00cfffef0000ffffe000ffffe000ffffe000ffffec00ffffe000ffffecf72f200000000000000000000000000000000000000000000000000
00077000000cc00000cccc000fccc0000fccc0000fccc0000fccc00000ccc0000000ccc0cfffef00000000000000000000000000000000000000000000000000
0070070000cccc000f0cc0f0000cc000000cc000000cc000000cc0000f0cc0000000cc0f00ccccf0000000000000000000000000000000000000000000000000
000000000f0cd0f0000cd0000cc00d00000cd0000dd00c00000dc00000cd00000000cd000f0ccd00000000000000000000000000000000000000000000000000
0000000000c00d0000c00d0000000d0000cd000000000c0000dc00000cd0000000000cd00000ccdd000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
babbabbbbbbbbfbb00babbb9bbbbbb00888a888a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb3bbbbb3bbbb0bbbb33bbfb3bbb0882888280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbb343333343bb3bbbb344333343bbb220222020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
43b34444444443b3bbb3444444443bfb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4434442449444434b33f4444244443bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444434bb344444444f43bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4f44444444e44444bb3494444444463b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444494444444444b34444444444443b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
42444444444444944444444442444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444464442244444244444444474000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444449444442e244444446444444777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444422444464444444447764000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
41444444444444444444444444444644000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030303010000000000000000000000030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000069000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000004240414300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000005052515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000004241404300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4141404143000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5250505050000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5052515250414140414041414140415000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050505253505252525150505252525200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050505050505050505050505050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
