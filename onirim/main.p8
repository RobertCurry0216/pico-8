pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--main
function _init()
	palswap()
	cards={}
	cols={
				"red", "blue"
				,"yellow","green"
			}
		vals={
			"door", "nightmare", "key"
		}
	for i=1,5 do
		add(cards,
		card:new(
			cols[ceil(rnd(4))],
			vals[ceil(rnd(3))]
		))
	end
end

function _update()

end

function _draw()
	cls(1)
	palt(0)
	palt(1,true)
	draw_board(cards)
end
-->8
--componants

--card
c_cols={
	red=8,
	blue=12,
	green=11,
	yellow=9
}

c_vals={
	sun=1,
	moon=2,
	key=3,
	door=4,
	nightmare=5,
}

card={
	__tostring=function(self)
		return "<card:"
		..self.color..":"
		..self.value..">"
	end
}

function card:new(col,val)
	local c={}
	--constructor
	setmetatable(c,card)
	c.color=col
	c.value=val
	--methods
	function c:draw(x,y)
		card_draw(self,x,y)
	end
	--end class
	return c
end

function card_draw(c,x,y)
	rect(x-1,y,x+8,y+11,7)
	rect(x,y-1,x+7,y+12,7)
	rectfill(x,y,x+7,y+11,c_cols[c.color])
	spr(c_vals[c.value],x,y+2)
end

--board
function draw_board(cards)
	local x,y=60-6*#cards,50
	local dy=1
	--border
	spr(64,32,y-22,8,4)
	spr(72,32,y+2,8,4)
	rectfill(0,y+1,128,y+9,0)
	line(0,y-1,128,y-1,0)
	line(0,y+11,128,y+11,0)
	--cards
	for c in all(cards) do
		c:draw(x,y)
		x+=6
	end
end
-->8
--game state

state = {}

function state:init()
	--reset
	self.deck={}
	self.hand={}
	self.board={}
	--load deck
	local cols = {
		"yellow","green","blue","red"
	}
	--create deck
	for k,color in pairs(cols) do
		--sun cards
		for i=1,k+5 do
			add(self.deck, card:new(color,"sun"))
		end
		--moon cards
		for i=1,4 do
			add(self.deck, card:new(color, "moon"))
		end
		--key cards
		for i=1,3 do
			add(self.deck, card:new(color, "key"))
		end
		--doors cards
		for i=1,2 do
			add(self.deck, card:new(color, "door"))
		end
	end
	--nightmare cards
	for i=1,10 do
		add(self.deck, card:new(0, "nightmare"))
	end
	shuffle(self.deck)
end	

-->8
--utils
function palswap()
	pal({[0]=128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143},1)
end

function shuffle(list)
  for i=#list,2,-1 do
		local j=ceil(rnd(i))
		list[i],list[j]=list[j],list[i]
	end
end


__gfx__
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111117177111177771111177111171777111151511111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711171771711777117111711711171777111155511111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111177777111771111111177111171777111555551111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111117777711771111111171111171177111575751111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711171771711777117111177111171777111555551111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111117717111177771111171111171777111555555111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111101111101101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111101111101101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111001111011001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111110011010010101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111110111010110011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111011010101e111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111100100100012111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111001001100111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111001110011011010001011101111111111111111111111111111111111111111111111111111100111111111111111111111111111111
11111111111111111110011100110011010001e01110011111111111111111111111111110000000111111111111111111111111111111111111000110001111
1111111111111111100111100e110110001010120111111111111111111111110000000000000000000000000000000000000000000000000000000000100000
1111111111111011001111001e000001001010112011111111001111000111111111111100001111011111111111001111111111111011101111111111111111
11111111111101111111100120000200000000011101101111110001111001111111111111100000000001111001110000000100110100011111100000000111
11111110000011111110001200002000000000011110010001111100011111111111111111111110010000000110011110010000001011011100011111111111
10000000111111111000112001000000000020000111001110001111100011111111111111111111111110000000001111200010000110110011111111111111
11111111111111100000000000001100000002010010011111111011111111001111111111111111111111111001100001220010010102100111111111111111
00000000000000001111111111100000000000000000000000000000000000011111111111111111111111111110111000112100001021000001111111111111
1111111111111111111111000111111111111111111111111111111111111111111111111111111111111111111121110000e100200020000111111111111111
11111111111111111111111111111111111111111101111111111111111111111111111111111111111111111111111110001101200101011111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100101120010111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011101e0011111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101112011111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011110011e011111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011110111101111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
__map__
494a4b4c494a4b4c494a4b4c4a4b4c4d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
595a5b5c595a5b5c595a5b5c5a5b5c5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
696a6b6c696a6b6c696a6b6c6a6b6c6d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
797a7b7c797a7b7c797a7b7c7a7b7c7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4a4b4c4d4a4b4c4d4a4b4c4d4a4b4c4d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5a5b5c5d5a5b5c5d5a5b5c5d5a5b5c5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a6b6c6d6a6b6c6d6a6b6c6d6a6b6c6d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7a7b7c7d7a7b7c7d7a7b7c7d7a7b7c7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4a4b4c4d4a4b4c4d4a4b4c4d4a4b4c4d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5a5b5c5d5a5b5c5d5a5b5c5d5a5b5c5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a6b6c6d6a6b6c6d6a6b6c6d6a6b6c6d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7a7b7c7d7a7b7c7d7a7b7c7d7a7b7c7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4a4b4c4d4a4b4c4d4a4b4c4d4a4b4c4d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5a5b5c5d5a5b5c5d5a5b5c5d5a5b5c5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a6b6c6d6a6b6c6d6a6b6c6d6a6b6c6d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7a7b7c7d7a7b7c7d7a7b7c7d7a7b7c7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
